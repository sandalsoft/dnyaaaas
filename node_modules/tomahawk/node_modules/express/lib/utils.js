function t(o,i){var t,e,r=o.split(/ *; */),n={value:r[0],quality:1,params:{},originalIndex:i};for(t=1;t<r.length;++t)e=r[t].split(/ *= */),"q"==e[0]?n.quality=parseFloat(e[1]):n.params[e[0]]=e[1];return n}var r=require("send").mime,n=require("buffer-crc32"),o=require("crypto"),i=require("path").basename,a=require("proxy-addr"),e=require("media-typer");exports.etag=function(e,t){if(0===e.length)return'"1B2M2Y8AsgTpgAmY7PhCfg=="';var r=o.createHash("md5").update(e,t).digest("base64");return'"'+r+'"'},exports.wetag=function(e,o){var t,r;return 0===e.length?'W/"0-0"':(t=Buffer.isBuffer(e)?e:new Buffer(e,o),r=t.length,'W/"'+r.toString(16)+"-"+n.unsigned(t)+'"')},exports.isAbsolute=function(e){return"/"==e[0]?!0:":"==e[1]&&"\\"==e[2]?!0:"\\\\"==e.substring(0,2)?!0:void 0},exports.flatten=function(r,t){var n,e;for(t=t||[],n=r.length,e=0;n>e;++e)Array.isArray(r[e])?exports.flatten(r[e],t):t.push(r[e]);return t},exports.normalizeType=function(e){return~e.indexOf("/")?t(e):{value:r.lookup(e),params:{}}},exports.normalizeTypes=function(t){var e,r=[];for(e=0;e<t.length;++e)r.push(exports.normalizeType(t[e]));return r},exports.contentDisposition=function(e){var t="attachment";return e&&(e=i(e),t=/[^\040-\176]/.test(e)?'attachment; filename="'+encodeURI(e)+"\"; filename*=UTF-8''"+encodeURI(e):'attachment; filename="'+e+'"'),t},exports.compileETag=function(e){var t;if("function"==typeof e)return e;switch(e){case!0:t=exports.wetag;break;case!1:break;case"strong":t=exports.etag;break;case"weak":t=exports.wetag;break;default:throw new TypeError("unknown value for etag function: "+e)}return t},exports.compileTrust=function(e){return"function"==typeof e?e:e===!0?function(){return!0}:"number"==typeof e?function(r,t){return e>t}:("string"==typeof e&&(e=e.split(/ *, */)),a.compile(e||[]))},exports.setCharset=function(t,r){if(!t||!r)return t;var n=e.parse(t);return n.parameters.charset=r,e.format(n)};
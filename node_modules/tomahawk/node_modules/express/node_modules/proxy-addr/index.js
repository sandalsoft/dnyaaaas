function i(n,r){var o,i,e,t;if(!n)throw new TypeError("req argument is required");if(o=(n.headers["x-forwarded-for"]||"").split(/ *, */).filter(Boolean).reverse(),i=n.connection.remoteAddress,e=[i].concat(o),!r)return e;for("function"!=typeof r&&(r=a(r)),t=0;t<e.length-1;t++)r(e[t],t)||(e.length=t+1);return e}function a(e){var t,n;if(!e)throw new TypeError("argument is required");if(t="string"==typeof e?[e]:e,!Array.isArray(t))throw new TypeError("unsupported trust argument");for(n=0;n<t.length;n++)e=t[n],r.hasOwnProperty(e)&&(e=r[e],t.splice.apply(t,[n,1].concat(e)),n+=e.length-1);return f(h(t))}function h(t){var e,r=Array(t.length);for(e=0;e<t.length;e++)r[e]=p(t[e]);return r}function f(e){var t=e.length;return 0===t?d:1===t?u(e[0]):c(e)}function p(i){var c,a,r,s=i.lastIndexOf("/"),n=-1!==s?i.substring(0,s):i;if(!t(n))throw new TypeError("invalid IP address: "+n);if(n=e(n),c=n.kind(),a="ipv4"===c?32:"ipv6"===c?128:0,r=-1!==s?i.substring(s+1,i.length):a,"number"!=typeof r&&(r=o.test(r)?parseInt(r,10):t(r)?l(r):0),"ipv6"===n.kind()&&n.isIPv4MappedAddress()&&(n=n.toIPv4Address(),r=a>=r?r-96:r),0>=r||r>a)throw new TypeError("invalid range on address: "+i);return[n,r]}function l(c){var r,n,o,t,i,a,s=e(c);switch(s.kind()){case"ipv4":r=s.octets,n=8;break;case"ipv6":r=s.parts,n=16;break;default:throw new TypeError("unknown netmask")}for(o=Math.pow(2,n)-1,i=0,a=0;a<r.length;a++){t=r[a]&o;{if(t!==o){for(;t;)t=t<<1&o,i+=1;break}i+=n}}return i}function s(t,r){var e,n;if(!t)throw new TypeError("req argument is required");if(!r)throw new TypeError("trust argument is required");return e=i(t,r),n=e[e.length-1]}function d(){return!1}function c(r){return function(p){var n,i,a,s,c,u,l,o;if(!t(p))return!1;for(n=e(p),a=n.kind(),o=0;o<r.length;o++){if(s=r[o],c=s[0],u=c.kind(),subnetrange=s[1],l=n,a!==u){if("ipv6"!==a||"ipv4"!==u||!n.isIPv4MappedAddress())continue;i=i||n.toIPv4Address(),l=i}if(l.match(c,subnetrange))return!0}return!1}}function u(n){var r=n[0],o=r.kind(),a="ipv4"===o,i=n[1];return function(c){var n,s;return t(c)?(n=e(c),s=n.kind(),s===o?n.match(r,i):a&&"ipv6"===s&&n.isIPv4MappedAddress()?n.toIPv4Address().match(r,i):!1):!1}}var n,o,t,e,r;module.exports=s,module.exports.all=i,module.exports.compile=a,n=require("ipaddr.js"),o=/^[0-9]+$/,t=n.isValid,e=n.parse,r={linklocal:["169.254.0.0/16","fe80::/10"],loopback:["127.0.0.1/8","::1/128"],uniquelocal:["10.0.0.0/8","172.16.0.0/12","192.168.0.0/16","fc00::/7"]};
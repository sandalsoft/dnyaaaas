function e(e,t){if(!t)return e;for(var r in t)e[r]=t[r];return e}var t=require("escape-html"),o=require("parseurl"),i=require("path").resolve,r=require("send"),n=require("url");exports=module.exports=function(c,a){var u,s;if(a=e({},a),!c)throw new TypeError("root path required");if(c=i(c),u=!1!==a.redirect,s=a.setHeaders,delete a.setHeaders,s&&"function"!=typeof s)throw new TypeError("option setHeaders must be function");return a.maxage=a.maxage||a.maxAge||0,a.root=c,function(i,l,h){var d,p,f,c;return"GET"!=i.method&&"HEAD"!=i.method?h():(d=e({},a),p=n.parse(i.originalUrl||i.url),f=o(i).pathname,"/"===f&&"/"!==p.pathname[p.pathname.length-1]&&(f=""),c=r(i,f,d),u?c.on("directory",function(){p.pathname+="/";var e=n.format(p);l.statusCode=303,l.setHeader("Content-Type","text/html; charset=utf-8"),l.setHeader("Location",e),l.end('Redirecting to <a href="'+t(e)+'">'+t(e)+"</a>\n")}):c.on("directory",h),s&&c.on("headers",s),c.on("error",function(e){h(404===e.status?null:e)}),void c.pipe(l))}},exports.mime=r.mime;
function e(e){this.nsp=e,this.rooms={},this.sids={},this.encoder=new r.Encoder}var t=require("events").EventEmitter,r=require("socket.io-parser");module.exports=e,e.prototype.__proto__=t.prototype,e.prototype.add=function(e,t,r){this.sids[e]=this.sids[e]||{},this.sids[e][t]=!0,this.rooms[t]=this.rooms[t]||[],this.rooms[t][e]=!0,r&&process.nextTick(r.bind(null,null))},e.prototype.del=function(e,t,r){this.sids[e]=this.sids[e]||{},this.rooms[t]=this.rooms[t]||{},delete this.sids[e][t],delete this.rooms[t][e],r&&process.nextTick(r.bind(null,null))},e.prototype.delAll=function(e){var t,r=this.sids[e];if(r)for(t in r)delete this.rooms[t][e];delete this.sids[e]},e.prototype.broadcast=function(o,r){var e,n=r.rooms||[],s=r.except||[],i=r.flags||{},a={},t=this;o.nsp=this.nsp.name,this.encoder.encode(o,function(c){var o,u,r;if(n.length){for(o=0;o<n.length;o++)if(u=t.rooms[n[o]])for(r in u)a[r]||~s.indexOf(r)||(e=t.nsp.connected[r],e&&(e.packet(c,!0,i.volatile),a[r]=!0))}else for(r in t.sids)~s.indexOf(r)||(e=t.nsp.connected[r],e&&e.packet(c,!0,i.volatile))})};
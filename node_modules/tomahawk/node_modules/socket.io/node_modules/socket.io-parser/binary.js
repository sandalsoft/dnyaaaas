function t(e){return global.Buffer&&Buffer.isBuffer(e)||global.ArrayBuffer&&e instanceof ArrayBuffer}var e=require("isarray");exports.deconstructPacket=function(o){function r(n){var a,o,i,s;if(!n)return n;if(global.Buffer&&Buffer.isBuffer(n)||global.ArrayBuffer&&n instanceof ArrayBuffer)return a={_placeholder:!0,num:t.length},t.push(n),a;if(e(n)){for(o=Array(n.length),i=0;i<n.length;i++)o[i]=r(n[i]);return o}if("object"==typeof n&&!(n instanceof Date)){o={};for(s in n)o[s]=r(n[s]);return o}return n}var t=[],i=o.data,n=o;return n.data=r(i),n.attachments=t.length,{packet:n,buffers:t}},exports.reconstructPacket=function(t,n){function r(t){var s,o,i;if(t&&t._placeholder)return s=n[t.num];if(e(t)){for(o=0;o<t.length;o++)t[o]=r(t[o]);return t}if(t&&"object"==typeof t){for(i in t)t[i]=r(t[i]);return t}return t}return t.data=r(t.data),t.attachments=void 0,t},exports.removeBlobs=function(s,i){function n(s,p,l){var c,a,u;if(!s)return s;if((global.Blob&&s instanceof Blob||global.File&&s instanceof File)&&(o++,c=new FileReader,c.onload=function(){l?l[p]=this.result:r=this.result,--o||i(r)},c.readAsArrayBuffer(s)),e(s))for(a=0;a<s.length;a++)n(s[a],a,s);else if(s&&"object"==typeof s&&!t(s))for(u in s)n(s[u],u,s)}var o=0,r=s;n(r),o||i(r)};